<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta name="generator" content="pandoc">
  
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="/style.css" type="text/css">
</head>
<body>
<ol><li>When you create a new VPC</li></ol>
<ul><li>It creates new route table, network acl and security group, but not internet gateway or subnets</li></ul>
<p>*** Basically now we have what we see in screenshot1 ***</p>
<ol><li>When we create a subnet manually</li></ol>
<ul>
<li>Name: 10.0.1.0 - us-east-2a<br>
* the CIDR segment we gave is 10.0.1.0/24 (which should give 256 unique address but AWS takes some)<br>
* use this AZ us-east-2a</li>
<li>Name: 10.0.2.0 - us-east-2b<br>
* the CIDR segment we gave is 10.0.1.0/24<br>
* use this AZ us-east-2b</li>
</ul>
<ol><li>we made 10.0.1.0 - us-east-2a pubically accessible</li></ol>
<ul><li>we can now launh EC2 instances into it with pubically accessible IP addresses, so we enable the aut assign IP address setting of this subnet</li></ul>
<ol>
<li><p>We create internet gateway and attach to our VPC</p></li>
<li>Create our route Table MyPublicNet</li>
</ol>
<ul>
<li>So we can configure our main route so we have aroute to the internet (from our VPC)</li>
<li>By default our subnet has an association with the main route table, so if we were to add public internet access to our main route table, then our subnets would have that access aswell, however thats bad security<br>
* best practice is to keep mainroute table as private and then have a seperate route table for our pubic subnets</li>
<li>We create MyPublicNet</li>
</ul>
<ol><li>Edit our MyPublicNet route table routes to be able to connect to public internet</li></ol>
<ul>
<li>Create a new route for IPV4<br>
* set desintation as 0.0.0.0/0 and target to be the internet gateway we just created</li>
<li>Create a new route for IPV6<br>
*set desintation as ::/0 and target to be the internet gateway we just created</li>
<li>So now any subnets associates with this route tables will automatically become public for both IPv4 and IPv6</li>
</ul>
<ol><li>Associate Subnet to Route table</li></ol>
<ul><li>10.0.1.0 - us-east-2a (this subnet to be exact)</li></ul>
<p>*** So now we have a pubic subnet ( 10.0.1.0 - us-east-2a) and a private subnet ( 10.0.2.0 - us-east-2b) ***</p>
<p>*** Basically now we have what we see in screenshot2 ***</p>
<p>Now lets launch two instances in our VPCs</p>
<ol><li>Spin up Public EC2 instance (WebServer01)</li></ol>
<ul>
<li>for network we choose our newly made vpc,</li>
<li>we use our newly made subnet of 10.0.1.0 - us-east-2a</li>
<li>and we leave on auto assigned public ip (we use subnet settings which is public)</li>
<li>set a tag (not sure why)</li>
<li>configure a security group (WebDMZ)<br>
* give that SSH access (:20) and HTTP access (:80)</li>
</ul>
<ol><li>Spin up Private EC2 instance (MyDBServer)</li></ol>
<ul>
<li>Same as above but since we are using the 10.0.2.0 - us-east-2b subnet, it will not have a public ip</li>
<li>We used the default security group instead of the WebDMZ</li>
</ul>
<p>*** Basically now we have what we see in screenshot3 ***</p>
<ol><li>So now we can actually ssh onto our public instance</li></ol>
<ul>
<li>Modify the key pem file we downloaded when we created our security group, run <code>chmod 400 key.pem</code> on it and now we can ssh onto our host <code>ssh ec2-user@xx.xxx.xxx.xxx -i key.pem</code>
</li>
<li>And right now we can only connect into our public EC2 instance because we have a public ip address</li>
</ul>
<p>Review 1-9:</p>
<ul>
<li>When you create a VPC a default Route Table, Network Access Control List (NACL) and a default Security Group is created</li>
<li>It won't create any subnets, not will it create a default internet gateway.</li>
<li>and off topic, but us-east-1A in your AWS account can be a completely different az then us-east-1qa in another AWS account, the AZ's are randomized</li>
<li>Amazon always reserve 5 IP address within your subnet</li>
<li>You cn only have 1 Internet Gateway per VPC</li>
<li>Security Groups can't span VPCs.</li>
</ul>
<p>*** Now we will work on connecting our EC2 instance in our public subnet to our EC2 instance in our private subnet ***</p>
<p>So right now, we are unable to SSH from our public EC2 instance into the private ES2 instance as they belong to different security groups,</p>
<p>Since the second EC2 instance is called MyDBServer</p>
<ul>
<li>Lets make a DB security group (MyDBSG)</li>
<li>Add new inbound rule<br>
* ALL ICMP - IPv4<br>
* HTTP<br>
* HTTPS<br>
* SSH<br>
* MYSQL/Aurora</li>
<li>And lets assign this newly made security group to the MyDBServer instance<br>
* As prove it works, we can now ping/ssh the MyDBServer from WebDMZ<br>
* to ssh we use the the same ssh command but we need to copy the private key over, bad practice<br>
* Confirmed, we can ssh into our private server from our public server<br>
* So fun fact, since we are in a private subnet with no route to the internet, if we did <code>yum update</code> it will actually timeout</li>
</ul>
      <div id="footer">
        Notes by <a href="https://github.com/yfjd01.github.io">Yifan Dai</a>, 
        Connect with me on <a href="https://www.linkedin.com/in/yfjd01/">LinkedIn</a>.
      </div>
</body>
</html>
